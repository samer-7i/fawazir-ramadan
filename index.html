<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Remy ðŸŽ®</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="script.js"></script>

    <style>
        :root { --bg: #0a1120; --card: #162136; --blue: #38bdf8; --red: #e94560; --gold: #fbbf24; }
        body { margin: 0; padding: 0; background: var(--bg); color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        .header { padding: 40px 20px 10px; text-align: center; width: 100%; }
        .logo { width: 115px; height: 115px; border-radius: 50%; border: 3px solid var(--blue); box-shadow: 0 0 20px rgba(56,189,248,0.4); margin-bottom: 20px; }
        
        #q-status { font-size: 2em; color: var(--blue); margin: 0; }
        #q-text { font-size: 1.2em; color: var(--gold); margin: 15px 20px; font-weight: bold; min-height: 30px; }

        .user-card { background: var(--card); padding: 20px; border-radius: 20px; text-align: center; width: 85%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 20px; }
        .pts-box { background: var(--red); color: white; padding: 10px 20px; border-radius: 10px; font-weight: bold; display: inline-block; margin-top: 10px; }

        .answers-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 90%; max-width: 400px; }
        .btn-opt { background: var(--card); color: #fff; border: 2px solid var(--blue); padding: 20px 10px; border-radius: 15px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-opt:active { transform: scale(0.95); background: var(--blue); }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="header">
        <img src="logo.png" class="logo">
        <h1 id="q-status">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø³Ø¤Ø§Ù„...</h1>
        <p id="q-text"></p>
    </div>

    <div class="user-card">
        <h3 id="display-name" style="margin:0">Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚: Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
        <div class="pts-box">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="points-count">0</span></div>
    </div>

    <div id="quiz-area" class="hidden">
        <div class="answers-grid" id="grid-btns"></div>
    </div>

    <script>
        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ (ØªÙ…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ù„Ø£Ù†Ù‡Ø§ ØªÙ…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©)
        function showQuestion(idx) {
            const status = document.getElementById("q-status");
            const text = document.getElementById("q-text");
            const area = document.getElementById("quiz-area");
            const grid = document.getElementById("grid-btns");

            if (idx === -1 || idx === null) {
                status.innerText = "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø³Ø¤Ø§Ù„...";
                text.innerText = "Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ðŸ”¥";
                area.classList.add("hidden");
            } else {
                const data = window.allQuestions ? window.allQuestions[idx] : null;
                if (data) {
                    status.innerText = "Ø§Ù„Ø³Ø¤Ø§Ù„ " + (parseInt(idx) + 1);
                    text.innerText = data.q;
                    grid.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±

                    data.options.forEach((opt, i) => {
                        const b = document.createElement("button");
                        b.className = "btn-opt";
                        b.innerText = opt;
                        b.onclick = () => submitAns(idx, i);
                        grid.appendChild(b);
                    });
                    area.classList.remove("hidden");
                }
            }
        }

        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù€ Firebase Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
        db.ref('currentQuestion').on('value', snap => showQuestion(snap.val()));

        // Ø§Ø³Ù… Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ ÙˆØ§Ù„Ù†Ù‚Ø§Ø· (Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¹Ø¯Ù… Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†Ù‚Ø§Ø·)
        let myName = localStorage.getItem("userName") || "Ù…ØªØ³Ø§Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯";
        document.getElementById("display-name").innerText = "Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚: " + myName;

        // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØµØ­ÙŠØ­Ø©
        db.ref('totalPoints/' + myName.replace(/ /g, '_')).on('value', s => {
            document.getElementById("points-count").innerText = s.val() || 0;
        });

        function submitAns(qIdx, cIdx) {
            db.ref('winners/' + qIdx + '/' + myName.replace(/ /g, '_')).set({
                name: myName, answer: cIdx, timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            document.getElementById("quiz-area").classList.add("hidden");
            document.getElementById("q-text").innerText = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! âœ…";
        }
    </script>
</body>
</html>
