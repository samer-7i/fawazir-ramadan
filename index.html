<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Remy ğŸ®</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #0a1120; --card: #162136; --blue: #38bdf8; --text: #ffffff; --red: #e94560; --gold: #f59e0b; --accent: #10b981; }
        body { margin: 0; padding: 20px; background: var(--bg); color: var(--text); font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
        
        #question-text { font-size: 2.2em; line-height: 1.4; margin-bottom: 20px; font-weight: bold; }
        
        .user-logo { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--blue); margin-bottom: 20px; object-fit: cover; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .setup-card { background: var(--card); padding: 30px; border-radius: 25px; border: 2px solid var(--blue); max-width: 400px; width: 85%; text-align: center; }
        input { width: 90%; padding: 15px; border-radius: 12px; border: 1px solid var(--blue); background: #0a1120; color: white; text-align: center; font-size: 1.1em; margin: 15px 0; outline: none; }
        .btn-action { background: var(--blue); color: var(--bg); border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; }
        .main-card { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid rgba(56, 189, 248, 0.2); max-width: 500px; width: 100%; display: none; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
        .user-info { display: flex; justify-content: space-between; background: rgba(255,255,255,0.05); padding: 10px 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(56,189,248,0.2); font-size: 0.9em; }
        .timer-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.1); margin-bottom: 20px; border-radius: 4px; overflow: hidden; }
        #timer-progress { width: 100%; height: 100%; background: var(--gold); transition: width 0.1s linear; }
        #delay-timer { color: var(--gold); font-weight: bold; font-size: 1.2em; margin: 10px 0; }
        .opt-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; border: 1px solid var(--blue); background: rgba(56, 189, 248, 0.05); color: white; border-radius: 12px; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: 0.2s; }
        .opt-btn:active { transform: scale(0.98); background: var(--blue); color: #000; }
        .opt-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        #status-msg { margin-top: 15px; font-weight: bold; font-size: 1.1em; }
    </style>
</head>
<body>

    <img src="logo.png" class="user-logo" onerror="this.style.display='none'">

    <div id="setup-overlay" class="overlay">
        <div class="setup-card" id="rules-step">
            <h2 style="color: var(--blue);">ğŸ“œ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h2>
            <div style="text-align: right; font-size: 0.9em; line-height: 1.6; list-style: none;">
                <li>âœ… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø³ØªØ±ÙŠÙ…Ø± Ø¶Ø±ÙˆØ±ÙŠØ© .</li>
                <li>âœ… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ ÙƒÙ„ ÙØ²ÙˆØ±Ø©.</li>
                <li>âœ… Ø£Ø³Ø±Ø¹ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·.</li>
                <li>âœ… ÙŠØªÙ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø¨Ø¹Ø¯ Ø±Ù…Ø¶Ø§Ù† .</li>
                <li>âœ… ÙŠÙ…Ù†Ø¹ Ø§Ù„ØºØ´ Ø¨Ø¬Ù…ÙŠØ¹ Ø£Ø´ÙƒØ§Ù„Ù‡.</li>
                <li>âœ… ÙŠÙ…Ù†Ø¹ ØªØºÙŠÙŠØ± Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø¶Ù…Ø§Ù† Ø­ÙØ¸ Ø§Ù„Ù†Ù‚Ø§Ø·.</li>
                <li>âœ… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø¬Ù…Ø¹Ø© Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© .</li>
            </div><br>
            <button class="btn-action" onclick="showNameInput()">Ù…ÙˆØ§ÙÙ‚ âœ…</button>
        </div>
        <div class="setup-card" id="name-step" style="display: none;">
            <h2>Ø³Ø¬Ù„ Ø§Ø³Ù…Ùƒ ğŸ®</h2>
            <input type="text" id="username-input" placeholder="Ø§Ø³Ù…Ùƒ ÙÙŠ Ø¬Ø§ÙƒÙˆ...">
            <button class="btn-action" onclick="saveAndStart()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸš€</button>
        </div>
    </div>

    <div id="waiting-msg" style="display:none; text-align:center; width: 100%; max-width: 500px;">
        <h3 style="color: var(--blue);">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø£Ù† ÙŠØ¨Ø¯Ø£ remy Ø§Ù„Ø³Ø¤Ø§Ù„... âŒ›</h3>
        <p>Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span id="wait-points" style="font-weight: bold; color: var(--gold);">0</span></p>
    </div>

    <div id="quiz-container" class="main-card">
        <div class="timer-bar"><div id="timer-progress"></div></div>
        <div class="user-info">
            <span id="display-name" style="color: var(--blue); font-weight: bold;">---</span>
            <span>Ù†Ù‚Ø§Ø·ÙŠ: <span id="my-points" style="color: var(--blue); font-weight: bold;">0</span> Ù†</span>
        </div>
        <div id="question-text"></div>
        <div id="delay-timer"></div>
        <div id="options-container"></div>
        <div id="status-msg"></div>
    </div>

    <script>
        const config = { 
            apiKey: "AIzaSyBxqfLt3o3JWy_vwnpwSQPIVdtEDGoYB6k",
            authDomain: "fawazir-jaco.firebaseapp.com",
            databaseURL: "https://fawazir-jaco-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "fawazir-jaco",
            storageBucket: "fawazir-jaco.firebasestorage.app",
            messagingSenderId: "862747657100",
            appId: "1:862747657100:web:d52ecee9373a5e33fd8ca9"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        let userName = localStorage.getItem("remy_name_v4");
        let userID = localStorage.getItem("remy_id_v4");
        let timerInterval, delayInterval;
        let serverStartTime = 0;

        const myQuestions = [
{ q: "Ù¡/Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠ Ø§Ù„Ø°ÙŠ ØªÙ…Ø³ÙƒÙ‡ Ø¯ÙˆÙ† Ø§Ù† ØªÙ„Ù…Ø³Ù‡ØŸ", options: ["Ø§Ù„ÙˆØ¹Ø¯", "Ø§Ù„Ù†ÙØ³", "Ø§Ù„Ø¬Ù†ÙŠ"], correct: 0 },
  { q: "Ù¢/Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙØ³ØªØ®Ø¯Ù… Ù„ØªÙˆØ­ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø¨Ø´Ø±Ø© ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹ÙŠÙˆØ¨ØŸ", options: ["Ø§Ù„ÙØ§ÙˆÙ†Ø¯ÙŠØ´Ù†", "Ø§Ù„Ù‡Ø§ÙŠÙ„Ø§ÙŠØªØ±", "Ø§Ù„ØªÙˆÙ†Ø±"], correct: 0 },
  { q: "Ù£/Ø³ÙŠØ§Ø±Ø© \"ØªÙŠØ³Ù„Ø§\" (Tesla) Ù…Ø´Ù‡ÙˆØ±Ø© Ø¨Ø£Ù†Ù‡Ø§ ØªØ¹Ù…Ù„ Ø¨Ù€Ù…Ø§Ø°Ø§ØŸ", options: ["Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†", "Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡", "Ø§Ù„ÙØ­Ù…"], correct: 1 },
  { q: "Ù¤/Ø®Ù…Ù† Ø§Ù„Ù…Ø«Ù„ Ù…Ù† Ø§Ù„Ø§ÙŠÙ…ÙˆØ¬ÙŠ: ğŸ«²ğŸ”¥ğŸ«²ğŸ’§ØŸ", options: ["Ø§Ù„Ù„ÙŠ ÙŠØ¯Ù‡ Ù…Ø­ØªØ±Ù‚Ù‡ Ù…Ùˆ Ù…Ø«Ù„ Ø§Ù„Ù„ÙŠ ÙŠØ¯Ù‡ Ù…Ø«Ù„Ø¬Ù‡", "Ø§Ù„Ù„ÙŠ ÙŠØ¯Ù‡ ÙÙŠ Ø§Ù„Ù†Ø§Ø± Ù…Ùˆ Ù…Ø«Ù„ Ø§Ù„Ù„ÙŠ ÙŠØ¯Ù‡ ÙÙŠ Ø§Ù„Ù…ÙˆÙŠØ§", "Ø§Ù„Ù„ÙŠ ÙŠØ¯Ù‡ Ù…Ù„ØªÙ‡Ø¨Ù‡ Ù…Ùˆ Ù…Ø«Ù„ Ø§Ù„Ù„ÙŠ ÙŠØ¯Ù‡ ÙÙŠ Ø§Ù„Ø¨Ø±Ø§Ø¯"], correct: 1 },
  { q: "Ù¥/Ø®Ù…Ù† Ø§Ù„Ø§ÙƒÙ„Ù‡ Ù…Ù† Ø§Ù„Ø§ÙŠÙ…ÙˆØ¬ÙŠ: ğŸˆğŸ˜˜ØŸ", options: ["Ø¨Ø³Ø¨ÙˆØ³Ù‡", "Ø¨Ø³Ù‡ ØªØ­Ø¨ Ø§Ù„Ø¨Ø³Ø¨ÙˆØ³Ù‡", "Ø§Ù„Ø§Ù†Ø³Ø§Ù† ÙŠØ­Ø¨ ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨Ø³Ù‡"], correct: 0 },
  { q: "Ù¦/Ù†Ø§Ø¯ÙŠ Ø§Ù„Ø§ØªØ­Ø§Ø¯ØŒ Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø´Ø¹Ø§Ø±Ù‡ ÙˆÙŠÙ„Ù‚Ø¨ Ø¨Ù‡ØŸ", options: ["Ø§Ù„ØµÙ‚Ø±", "Ø§Ù„Ù†Ù…Ø±", "Ø§Ù„Ø°Ø¦Ø¨"], correct: 1 },
  { q: "Ù§/Ø£ÙŠÙ† ÙŠÙ‚Ø¹ Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠÙ‡ Ù‚Ø·Ø±Ø© Ù…Ø§Ø¡ØŸ", options: ["ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡", "Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©", "ÙÙŠ Ø§Ù„ØµØ­Ø±Ø§Ø¡ Ø§Ù„ÙƒØ¨Ø±Ù‰"], correct: 1 },
  { q: "Ù¨/Ù…Ø§Ø°Ø§ Ù†Ø³ØªØ®Ø¯Ù… Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¨Ø³ÙŠØ·Ø© ÙÙŠ Ø§Ù„ÙƒØ­Ù„ØŸ", options: ["Ø£Ø¹ÙˆØ§Ø¯ Ø§Ù„Ù‚Ø·Ù† Ù…Ø¹ Ù…Ø²ÙŠÙ„ Ù…ÙƒÙŠØ§Ø¬", "Ø§Ù„Ù…Ù…Ø­Ø§Ø©", "Ø§Ù„Ù…Ø§Ø¡ ÙˆØ§Ù„ØµØ§Ø¨ÙˆÙ† Ù…Ø¨Ø§Ø´Ø±Ø©"], correct: 0 },
  { q: "Ù©/Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙ…ØªÙ„Ùƒ Ø±Ø¦Ø© ÙˆÙ„Ø§ ÙŠØªÙ†ÙØ³ØŸ", options: ["Ø§Ù„Ø§Ø³ÙÙ†Ø¬Ù‡", "Ø§Ù„Ø³ÙŠØ§Ø±Ù‡", "Ø§Ù„Ù…Ù†ÙØ§Ø®"], correct: 2 },
  { q: "Ù¡Ù /Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙ…ØªÙ„Ùƒ Ø¹Ø±ÙˆÙ‚Ø§Ù‹ ÙˆÙ„Ø§ ÙŠØ¬Ø±ÙŠ ÙÙŠÙ‡Ø§ Ø¯Ù…ØŸ", options: ["ÙˆØ±Ù‚Ø© Ø§Ù„Ø´Ø¬Ø±", "Ø§Ù„Ø±Ø®Ø§Ù…", "Ø§Ù„Ø®Ø±ÙŠØ·Ø©"], correct: 0 },
  { q: "Ù¡Ù¡/Ø§ÙŠ ØµÙ„Ø§Ù‡ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠÙ‡Ø§ Ù„Ø§ Ø±ÙƒÙˆØ¹ Ùˆ Ù„Ø§ Ø³Ø¬ÙˆØ¯ØŸ", options: ["ØµÙ„Ø§Ø© Ø§Ù„Ø§Ø³ØªØ³Ù‚Ø§Ø¡", "ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù†Ø§Ø²Ø©", "ØµÙ„Ø§Ø© Ø§Ù„ÙƒØ³ÙˆÙ"], correct: 1 },
  { q: "Ù¡Ù¢/Ø´ÙŠ ÙŠÙ…ØªÙ„Ùƒ Ø±ÙŠØ´Ø§Ù‹ Ùˆ Ù„Ø§ ÙŠØ·ÙŠØ±ØŸ", options: ["Ø§Ù„Ù…Ø®Ø¯Ù‡", "Ø§Ù„Ø¯Ø¬Ø§Ø¬Ø©", "Ø§Ù„Ø³Ù‡Ù…"], correct: 0 },
  { q: "Ù¡Ù£/Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† Ø§Ù„Ù†Ø¨ÙŠ ï·º ÙŠØ­Ø¨ Ù„Ø¨Ø³Ù‡ ÙƒØ«ÙŠØ±Ø§Ù‹ØŸ", options: ["Ø§Ù„Ø§Ø­Ù…Ø±", "Ø§Ù„Ø§Ø¨ÙŠØ¶", "Ø§Ù„Ø§Ø®Ø¶Ø±"], correct: 1 },
  { q: "Ù¡Ù¤/Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠ Ø§Ù„Ø°ÙŠ ÙŠÙ…ØªÙ„Ùƒ Ø§Ø¨Ù‡Ø§Ù…Ø§Ù‹ Ùˆ Ù¤ Ø§ØµØ§Ø¨Ø¹ ÙˆÙ„ÙƒÙ†Ù‡ Ù„ÙŠØ³ Ø­ÙŠØ§Ù‹ØŸ", options: ["Ø§Ù„Ù‚ÙØ§Ø²", "Ø§Ù„ØªÙ…Ø«Ø§Ù„", "ÙŠØ¯ Ø§Ù„Ø¨Ø´Ø±"], correct: 0 },
  { q: "Ù¡Ù¥/Ù…Ø§Ø°Ø§ ÙŠØ¹Ù†ÙŠ SPF ÙÙŠ ÙˆØ§Ù‚ÙŠ Ø§Ù„Ø´Ù…Ø³ØŸ", options: ["Ø¹Ø§Ù…Ù„ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø´Ù…Ø³", "Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬", "Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©"], correct: 0 },
  { q: "Ù¡Ù¦/Ù…Ø§ Ù‡Ùˆ ÙØ¶Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©ØŸ options: ["ØªØ²ÙŠØ¯ Ø§Ù„Ø±Ø²Ù‚", "ØªØ¶ÙŠØ¡ Ù„Ù„Ù…Ø³Ù„Ù… Ù†ÙˆØ±Ø§Ù‹ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù…Ø¹ØªÙŠÙ†", "ØªØ­Ù…ÙŠ Ù…Ù† Ø§Ù„Ù…Ø±Ø¶"], correct: 1 },
  { q: "Ù¡Ù§/Ø®Ù…Ù† Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ø§ÙŠÙ…ÙˆØ¬ÙŠ: Ø§Ø³ ğŸ’§", options: ["Ø§Ø³Ù…Ø§Ø¡", "Ø§Ø³Ù‚Ø·Ø±Ø©", "Ù…Ø§Ø³Ù‡"], correct: 0 },
  { q: "Ù¡Ù¨/Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠ Ø§Ù„Ø°ÙŠ ØªØ±Ø§Ù‡ ÙÙŠ Ø§Ù„Ù„ÙŠÙ„ Ù£Ù…Ø±Ø§Øª ØŸ", options: ["Ø§Ù„Ù†Ø¬ÙˆÙ…", "Ø­Ø±Ù Ø§Ù„Ù„Ø§Ù…", "Ø§Ù„Ù‚Ù…Ø±"], correct: 1 },
  { q: "Ù¡Ù©/Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø·ÙŠØ± Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ø·ÙŠØ± Ø§Ù„Ù‰ Ø§Ù„Ø®Ù„Ù ØŸ", options: ["Ø§Ù„Ø®ÙØ§Ø´", "Ø§Ù„Ø·Ù†Ø§Ù†", "Ø§Ù„Ø¨ÙˆÙ…Ø©"], correct: 1 },
  { q: "Ù¢Ù /Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ 3 ØªÙØ§Ø­Ø§Øª ÙˆØ£Ø®Ø°Øª Ù…Ù†Ù‡Ù… ØªÙØ§Ø­ØªÙŠÙ†ØŒ ÙÙƒÙ… ØªÙØ§Ø­Ø© Ù…Ø¹ÙƒØŸ", options: ["ØªÙØ§Ø­ØªÙŠÙ† Ø§Ù„Ù„ÙŠ Ù…Ø¹Ø§ÙŠ", "ØªÙØ§Ø­Ù‡", "Ù£ ØªÙØ§Ø­Ø§Øª"], correct: 0 },
  { q: "Ù¢Ù¡/Ù…Ù† Ø§ÙˆÙ„ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙˆØµÙ„Ù‡ØŸ", options: ["Ø§Ù„ØµÙŠÙ†", "Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠÙ‡", "Ø§Ù„ÙƒÙˆÙŠØª"], correct: 0 },
  { q: "Ù¢Ù¢/Ø®Ù…Ù† Ø§Ù„Ù…Ø«Ù„: ğŸ± + ğŸ­ + ğŸ  = ØŸ", options: ["Ø§Ù† ØºØ§Ø¨ Ø§Ù„Ù‚Ø· Ø§Ù„Ø¹Ø¨ ÙŠØ§ ÙØ§Ø±", "Ø§Ù† ØºØ§Ø¨ Ø§Ù„Ù‚Ø· Ø§Ù„Ø¹Ø¨ ÙŠØ§ ÙƒÙ„Ø¨", "Ø§Ù† ØºØ§Ø¨ Ø§Ù„ÙØ§Ø± Ø§Ù„Ø¹Ø¨ ÙŠØ§ Ù‚Ø·"], correct: 0 },
  { q: "Ù¢Ù£/Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠØ£ÙƒÙ„ ÙˆÙ„Ø§ ÙŠØ´Ø±Ø¨ØŒ ÙˆÙ…Ø¹ Ø°Ù„Ùƒ Ø°ÙƒØ± ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø£Ù†Ù‡ \"ÙŠØªÙ†ÙØ³\"ØŸ", options: ["Ø§Ù„Ø¬Ù†ÙŠÙ†", "Ø§Ù„ØµØ¨Ø­", "Ø§Ù„Ø¬Ø¨Ø§Ù„"], correct: 1 },
  { q: "Ù¢Ù¤/Ø³ÙŠØ§Ø±Ø© Ø±ÙŠØ§Ø¶ÙŠØ© Ø´Ø¹Ø§Ø±Ù‡Ø§ \"Ø§Ù„Ø«ÙˆØ± Ø§Ù„Ù‡Ø§Ø¦Ø¬\"ØŸ", options: ["Ù…ÙˆØ³ØªÙ†Ø¬", "Ù„Ø§Ù…Ø¨ÙˆØ±Ø¬ÙŠÙ†ÙŠ", "ÙÙŠØ±Ø§Ø±ÙŠ"], correct: 1 },
  { q: "Ù¢Ù¥/Ù…Ø§ Ù‡ÙŠ Ø§Ø®Ø± Ø³ÙˆØ±Ø© Ù†Ø²Ù„Øª Ø¨Ø§Ù„Ù‚Ø±Ø£Ù† ØŸ", options: ["Ø§Ù„Ù†ØµØ±", "Ø§Ù„ÙÙ„Ù‚", "Ø§Ù„Ø§Ø®Ù„Ø§Øµ"], correct: 0 },
  { q: "Ù¢Ù¦/Ø´ÙŠØ¡ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø´Ù†Ø·Ø© ÙˆØ¸ÙŠÙØªÙ‡ ÙŠØ±ÙØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¹Ø´Ø§Ù† ØªØºÙŠØ± Ø§Ù„ÙƒÙØ±ØŸ", options: ["Ø§Ù„Ù…ÙØªØ§Ø­", "Ø§Ù„Ø¹ÙØ±ÙŠØªØ©", "Ø§Ù„Ù‚Ù…Ø¹"], correct: 1 },
  { q: "Ù¢Ù§/ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙ‚Ø±Ø§Øª Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙÙ‚Ø±ÙŠØŸ", options: ["33", "34", "40"], correct: 0 },
  { q: "Ù¢Ù¨/Ù…Ù† Ù‡Ùˆ Ø§Ù„Ù†Ø¨ÙŠ Ø§Ù„Ø°ÙŠ ÙƒØ§Ù†Øª Ù…Ø¹Ø¬Ø²ØªÙ‡ \"Ø§Ù„Ù†Ø§Ù‚Ø©\" Ø§Ù„ØªÙŠ Ø®Ø±Ø¬Øª Ù…Ù† Ø§Ù„ØµØ®Ø±ØŸ", options: ["Ø³ÙŠØ¯Ù†Ø§ Ù‡ÙˆØ¯ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…", "Ø³ÙŠØ¯Ù†Ø§ ØµØ§Ù„Ø­ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…", "Ø³ÙŠØ¯Ù†Ø§ Ø´Ø¹ÙŠØ¨ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…"], correct: 1 },
  { q: "Ù¢Ù©/Ø³ÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… Ø°ÙÙƒØ± ÙÙŠÙ‡Ø§ \"Ø§Ù„Ø°Ø¨Ø§Ø¨\" Ùˆ \"Ø§Ù„Ø¨Ø¹ÙˆØ¶\"ØŸ", options: ["Ø³ÙˆØ±Ø© Ø§Ù„Ù†Ø­Ù„", "Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø³ÙˆØ±Ø© Ø§Ù„ÙÙŠÙ„"], correct: 1 },
  { q: "Ù£Ù /Ø£Ù†Ø´Ø¯Ùƒ Ø¹Ù† Ø±Ø¬Ù„Ù Ø³Ø±ÙŠØ¹ Ø§Ù„Ø®Ø·Ø§ÙˆÙŠ.. ÙŠÙ…Ø´ÙŠ Ø¹Ù„Ù‰ ÙƒØ¨Ø¯Ù‡ ÙˆÙ„Ø§ Ù„Ù‡ Ø±Ø¬Ù„ÙŠÙ†ØŒ Ù‚Ù„Ø¨Ù‡ Ø­Ø¯ÙŠØ¯ ÙˆÙ‚ÙˆØªÙ‡ ÙÙŠ Ø§Ù„Ø¹Ø²Ø§ÙˆÙŠ.. ØµÙˆØªÙ‡ ÙŠÙ‡Ø²Ù‘ Ø§Ù„Ø£Ø±Ø¶ Ø¨ÙŠÙ† Ø§Ù„Ø­ÙŠÙ† ÙˆØ§Ù„Ø­ÙŠÙ†ØŸ", options: ["Ø§Ù„Ù‚Ø·Ø§Ø±", "Ø§Ù„Ø³ÙŠÙˆÙ„", "Ø§Ù„Ø±Ø¹Ø¯"], correct: 0 }
        ];

        window.onload = () => { (userName && userID) ? startApp() : document.getElementById("setup-overlay").style.display = "flex"; };

        function showNameInput() { document.getElementById("rules-step").style.display = "none"; document.getElementById("name-step").style.display = "block"; }

        function saveAndStart() {
            const val = document.getElementById("username-input").value.trim();
            if (!val) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹!");
            userID = "u_" + Date.now();
            localStorage.setItem("remy_name_v4", val); localStorage.setItem("remy_id_v4", userID);
            userName = val; startApp();
        }

        function startApp() {
            document.getElementById("setup-overlay").style.display = "none";
            document.getElementById("display-name").innerText = userName;

            db.ref('users/' + userID + '/points').on('value', snap => {
                const p = snap.val() || 0;
                document.getElementById("my-points").innerText = p;
                document.getElementById("wait-points").innerText = p;
            });

            db.ref('roundVersion').on('value', () => {
                for (let key in localStorage) { if (key.startsWith("ans_")) localStorage.removeItem(key); }
            });

            db.ref('users/' + userID + '/name').set(userName);
            db.ref('celebration').on('value', snap => { if (snap.exists()) launchConfetti(); });

            db.ref('currentQuestion').on('value', snap => {
                const idx = snap.val();
                if (idx === -1 || idx === null) {
                    toggleQuiz(false);
                } else {
                    db.ref('questionStartTime').once('value', timeSnap => {
                        serverStartTime = timeSnap.val() || Date.now();
                        toggleQuiz(true);
                        prepareQuestion(idx);
                    });
                }
            });
        }

        function toggleQuiz(show) {
            document.getElementById("quiz-container").style.display = show ? "block" : "none";
            document.getElementById("waiting-msg").style.display = show ? "none" : "block";
            if(!show) { clearInterval(timerInterval); clearInterval(delayInterval); }
        }

        function prepareQuestion(idx) {
            const data = myQuestions[idx];
            clearInterval(timerInterval); clearInterval(delayInterval);
            document.getElementById("question-text").innerText = data.q;
            const container = document.getElementById("options-container");
            const delayArea = document.getElementById("delay-timer");
            const progressBar = document.getElementById("timer-progress");
            
            container.innerHTML = ""; 
            document.getElementById("status-msg").innerText = "";

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            if (localStorage.getItem("ans_" + idx)) {
                lockQuiz("ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ âœ‹", data, idx);
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (Ù„Ù…Ù†Ø¹ Ø§Ù„ØºØ´ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ«)
            db.ref('attempts/' + idx + '/' + userID).once('value', snap => {
                if (snap.exists()) {
                    lockQuiz("Ø­Ø§ÙˆÙ„Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹! ğŸš«", data, idx);
                } else {
                    runCountdown(data, idx);
                }
            });
        }

        function lockQuiz(msg, data, idx) {
            document.getElementById("delay-timer").innerText = "";
            document.getElementById("timer-progress").style.width = "0%";
            document.getElementById("status-msg").innerText = msg;
            showFinalOptions(data, idx, true);
        }

        function runCountdown(data, idx) {
            const delayArea = document.getElementById("delay-timer");
            const progressBar = document.getElementById("timer-progress");
            
            delayInterval = setInterval(() => {
                const now = Date.now();
                const diff = (now - serverStartTime) / 1000;
                const remaining = 10 - diff;
                
                let progress = (remaining / 10) * 100;
                progressBar.style.width = Math.max(0, progress) + "%";
                progressBar.style.background = "var(--gold)";

                if (remaining <= 0) {
                    clearInterval(delayInterval);
                    delayArea.innerText = "Ø£Ø¬Ø¨ Ø§Ù„Ø¢Ù†! ğŸ”¥";
                    progressBar.style.background = "var(--blue)";
                    showFinalOptions(data, idx, false);
                    startTimer();
                } else {
                    delayArea.innerText = `ØªØ¬Ù‡Ø².. ØªØ¸Ù‡Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø®Ù„Ø§Ù„ ${Math.ceil(remaining)}`;
                }
            }, 50);
        }

        function showFinalOptions(data, idx, isDisabled) {
            const container = document.getElementById("options-container");
            container.innerHTML = "";
            let options = data.options.map((opt, i) => ({ text: opt, isCorrect: i === data.correct }));
            options.sort(() => Math.random() - 0.5);
            options.forEach(item => {
                const b = document.createElement("button");
                b.className = "opt-btn"; b.innerText = item.text;
                if (isDisabled) b.disabled = true;
                b.onclick = () => submitAnswer(item.isCorrect, idx);
                container.appendChild(b);
            });
        }

        function startTimer() {
            let duration = 5000;
            let startTime = Date.now();
            
            timerInterval = setInterval(() => {
                let elapsed = Date.now() - startTime;
                let remaining = duration - elapsed;
                let progress = (remaining / duration) * 100;
                document.getElementById("timer-progress").style.width = Math.max(0, progress) + "%";
                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    disableAll("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! â±ï¸");
                }
            }, 50);
        }

        function submitAnswer(isCorrect, qIdx) {
            clearInterval(timerInterval);
            
            // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ÙÙˆØ±Ø§Ù‹ ÙÙŠ Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ Ù„ØºÙ„Ù‚ Ø§Ù„Ø«ØºØ±Ø©
            db.ref('attempts/' + qIdx + '/' + userID).set(true);
            
            localStorage.setItem("ans_" + qIdx, "true");
            document.getElementById("timer-progress").style.width = "0%";
            disableAll("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...");
            document.getElementById("delay-timer").innerText = "";

            if (!isCorrect) {
                document.getElementById("status-msg").innerText = "Ø®Ø·Ø£ âŒ";
                document.getElementById("status-msg").style.color = "#e94560";
                return;
            }

            db.ref('answers_logs/' + qIdx).push({ name: userName, timestamp: firebase.database.ServerValue.TIMESTAMP });
            db.ref('winners/' + qIdx).transaction(curr => {
                if (curr === null) return { name: userName, id: userID };
                return;
            }, (err, comm) => {
                const msg = document.getElementById("status-msg");
                if (comm) {
                    msg.innerText = "ÙƒÙÙˆ! Ø£Ù†Øª Ø§Ù„Ø£ÙˆÙ„ ğŸ‰"; msg.style.color = "#38bdf8";
                    db.ref('users/' + userID + '/points').transaction(p => (p || 0) + 1);
                } else {
                    msg.innerText = "ØµØ­ØŒ Ù„ÙƒÙ† ØºÙŠØ±Ùƒ Ø£Ø³Ø±Ø¹ ğŸ’¨"; msg.style.color = "#f59e0b";
                }
            });
        }

        function disableAll(msg) {
            document.querySelectorAll(".opt-btn").forEach(b => b.disabled = true);
            if(msg) document.getElementById("status-msg").innerText = msg;
        }

        function launchConfetti() {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, zIndex: 3000 });
        }
    </script>
</body>
</html>

