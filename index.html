<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Remy ğŸ® - Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { 
            --bg: #0a1120; 
            --card: #162136; 
            --blue: #38bdf8; 
            --red: #e94560; 
            --text: #ffffff; 
        }

        body { 
            margin: 0; padding: 20px; 
            background: var(--bg); color: var(--text); 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            text-align: center; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh;
        }

        /* --- ØªØµÙ…ÙŠÙ… Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† --- */
        #rules-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg);
            display: flex; justify-content: center; align-items: center;
            z-index: 2000;
        }
        .rules-card {
            background: var(--card);
            padding: 30px; border-radius: 25px;
            border: 2px solid var(--blue);
            max-width: 400px; width: 85%;
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.2);
        }
        .rules-list {
            text-align: right; margin: 20px 0;
            padding-right: 15px; line-height: 2;
            color: #cbd5e1;
        }
        .rules-list li { margin-bottom: 10px; }

        /* --- Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© --- */
        .main-card { 
            background: var(--card); padding: 30px; 
            border-radius: 20px; border: 1px solid rgba(56, 189, 248, 0.2); 
            max-width: 500px; width: 100%;
            display: none; /* Ù…Ø®ÙÙŠ Ø­ØªÙ‰ ÙŠÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† */
        }

        .logo { width: 90px; height: 90px; border-radius: 50%; border: 2px solid var(--blue); margin-bottom: 15px; }
        .q-text { font-size: 1.5em; font-weight: bold; margin: 20px 0; color: var(--blue); }
        
        .opt-btn { 
            display: block; width: 100%; padding: 15px; margin: 12px 0; 
            border: 1px solid var(--blue); background: rgba(56, 189, 248, 0.05); 
            color: white; border-radius: 12px; cursor: pointer; 
            font-size: 1.1em; transition: 0.2s; font-weight: bold;
        }
        .opt-btn:hover { background: var(--blue); color: var(--bg); transform: scale(1.02); }

        .btn-accept {
            background: var(--blue); color: var(--bg);
            border: none; padding: 15px 30px; border-radius: 12px;
            font-weight: bold; cursor: pointer; width: 100%; font-size: 1.1em;
        }

        #status-msg { margin-top: 20px; font-weight: bold; font-size: 1.1em; }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± */
        #waiting-msg { display: none; text-align: center; }
        .spinner { border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid var(--blue); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="rules-overlay">
        <div class="rules-card">
            <img src="logo.png" class="logo" onerror="this.src='https://via.placeholder.com/90'">
            <h2 style="color: var(--blue); margin-top: 0;">ğŸ“œ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h2>
            <ul class="rules-list">
                <li>âœ… Ø§Ù„Ø³Ø±Ø¹Ø© ÙÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡ÙŠ Ù…ÙØªØ§Ø­ Ø§Ù„ÙÙˆØ².</li>
                <li>âœ… ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ØªÙ…Ù†Ø­Ùƒ (1) Ù†Ù‚Ø·Ø©.</li>
                <li>âœ… ÙŠÙÙ…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø£Ùˆ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØºØ´.</li>
                <li>âœ… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø±ÙˆØ­ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙˆØ§Ù„Ù‡Ø¯ÙˆØ¡.</li>
                <li>âœ… Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¹ Remy!</li>
            </ul>
            <button class="btn-accept" onclick="acceptRules()">Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆØ¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© âœ…</button>
        </div>
    </div>

    <div id="waiting-msg">
        <img src="logo.png" class="logo">
        <h2>Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†Ø·Ù„Ø§Ù‚ Ø§Ù„Ø³Ø¤Ø§Ù„... âŒ›</h2>
        <div class="spinner"></div>
        <p style="color: #64748b;">Ø®Ù„ÙŠÙƒ Ù…Ø³ØªØ¹Ø¯ ÙŠØ§ Ø¨Ø·Ù„!</p>
    </div>

    <div id="quiz-container" class="main-card">
        <div id="question-text" class="q-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        <div id="options-container"></div>
        <div id="status-msg"></div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
        const firebaseConfig = {
            apiKey: "AIzaSyBxqfLt3o3JWy_vwnpwSQPIVdtEDGoYB6k",
            authDomain: "fawazir-jaco.firebaseapp.com",
            databaseURL: "https://fawazir-jaco-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "fawazir-jaco",
            storageBucket: "fawazir-jaco.firebasestorage.app",
            messagingSenderId: "862747657100",
            appId: "1:862747657100:web:d52ecee9373a5e33fd8ca9"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.database();

        // Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (ÙŠØ¬Ø¨ Ø£Ù† ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù†)
        const myQuestions = [
            { q: "Ù…Ù† Ù‡Ùˆ Ø§Ù„Ù†Ø¨ÙŠ Ø§Ù„Ø°ÙŠ Ù„ÙÙ‚Ø¨ Ø¨ÙƒÙ„ÙŠÙ… Ø§Ù„Ù„Ù‡ØŸ", options: ["Ø¹ÙŠØ³Ù‰", "Ù…ÙˆØ³Ù‰", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…"], correct: 1 },
            { q: "Ù…Ø§ Ù‡ÙŠ Ø£Ø·ÙˆÙ„ Ø³ÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…ØŸ", options: ["Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø§Ù„Ù†Ø³Ø§Ø¡", "Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†"], correct: 0 },
            { q: "Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ø«Ù„: Ø§Ù„Ù‚Ø±Ø¯ ÙÙŠ Ø¹ÙŠÙ† Ø£Ù…Ù‡", options: ["Ø­ØµØ§Ù†", "ÙÙŠÙ„", "ØºØ²Ø§Ù„"], correct: 2 },
            { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙ‚Ø±ØµÙƒ ÙˆÙ„Ø§ ØªØ±Ø§Ù‡ØŸ", options: ["Ø§Ù„Ù†Ù…Ù„Ø©", "Ø§Ù„Ø¬ÙˆØ¹", "Ø§Ù„Ø¨Ø±Ø¯"], correct: 1 }
        ];

        let currentQIdx = -1;
        let userName = localStorage.getItem("remy_user") || "Ù„Ø§Ø¹Ø¨_" + Math.floor(Math.random() * 9000 + 1000);
        localStorage.setItem("remy_user", userName); // ØªØ«Ø¨ÙŠØª Ø§Ù„Ø§Ø³Ù…

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†
        function acceptRules() {
            document.getElementById("rules-overlay").style.display = "none";
            checkCurrentStatus();
        }

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
        function checkCurrentStatus() {
            db.ref('currentQuestion').on('value', (snap) => {
                const idx = snap.val();
                currentQIdx = idx;
                const quizBox = document.getElementById("quiz-container");
                const waitBox = document.getElementById("waiting-msg");

                if (idx === -1 || idx === null) {
                    quizBox.style.display = "none";
                    waitBox.style.display = "block";
                } else {
                    waitBox.style.display = "none";
                    quizBox.style.display = "block";
                    showQuestion(idx);
                }
            });
        }

        function showQuestion(idx) {
            const data = myQuestions[idx];
            const qText = document.getElementById("question-text");
            const optBox = document.getElementById("options-container");
            const status = document.getElementById("status-msg");

            status.innerText = "";
            if (!data) {
                qText.innerText = "Ø³Ø¤Ø§Ù„ ØºÙŠØ± Ù…Ø¯Ø±Ø¬ Ø¨Ø¹Ø¯...";
                optBox.innerHTML = "";
                return;
            }

            qText.innerText = data.q;
            optBox.innerHTML = "";
            data.options.forEach((opt, i) => {
                const btn = document.createElement("button");
                btn.className = "opt-btn";
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(i);
                optBox.appendChild(btn);
            });
        }

        function handleAnswer(choiceIdx) {
            const data = myQuestions[currentQIdx];
            const status = document.getElementById("status-msg");
            const optButtons = document.querySelectorAll(".opt-btn");

            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            optButtons.forEach(b => b.disabled = true);

            if (choiceIdx === data.correct) {
                status.innerText = "Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ğŸ‰ ÙƒÙÙˆ..";
                status.style.color = "#10b981";
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§Ø¦Ø²
                db.ref('winners/' + currentQIdx).push({
                    name: userName,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    correct: true
                });

                // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø©
                db.ref('totalPoints/' + userName).transaction(p => (p || 0) + 1);
            } else {
                status.innerText = "Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©.. Ø­Ø¸ Ø£ÙˆÙØ±! âŒ";
                status.style.color = "#e94560";
            }
        }
    </script>
</body>
</html>
