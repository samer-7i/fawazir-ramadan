<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­ÙƒÙ… Remy ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #0a1120; --card: #162136; --blue: #38bdf8; --red: #e94560; --text: #ffffff; }
        body { margin: 0; padding: 20px; background: var(--bg); color: var(--text); font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        
        .panel { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid rgba(56, 189, 248, 0.2); width: 100%; max-width: 600px; margin-bottom: 20px; text-align: center; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù„ÙˆØ¬Ùˆ */
        .admin-logo { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--blue); margin-bottom: 10px; object-fit: cover; }
        
        .q-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 15px 0; }
        .q-btn { background: rgba(56, 189, 248, 0.1); color: var(--blue); border: 1px solid var(--blue); padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.9em; }
        .q-btn.active { background: var(--blue); color: #000; box-shadow: 0 0 10px var(--blue); }
        
        .btn-round { background: #f59e0b; color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .leader-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .winner-box { color: #10b981; font-size: 1.3em; font-weight: bold; margin-top: 5px; min-height: 1.5em; }
    </style>
</head>
<body>

    <div class="panel">
        <img src="logo.png" alt="Logo" class="admin-logo" onerror="this.style.display='none'">
        <h2 style="color: var(--blue); margin: 5px 0;">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Remy ğŸ‘‘</h2>
        <hr style="border: 0; border-top: 1px solid rgba(56,189,248,0.2); margin: 15px 0;">
        <div id="active-q" style="color: #888;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¤Ø§Ù„ Ù…Ø¨Ø§Ø´Ø± Ø­Ø§Ù„ÙŠØ§Ù‹</div>
        <div class="winner-box">Ø§Ù„ÙØ§Ø¦Ø²: <span id="winner-name">---</span></div>
    </div>

    <div class="panel">
        <h3 style="margin-top:0">Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
        <div class="q-grid" id="btn-container"></div>
        <button onclick="sendQ(-1)" style="background: var(--red); color:white; border:none; padding:12px; width:100%; border-radius:10px; cursor:pointer; font-weight:bold;">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹ ğŸ›‘</button>
        <button class="btn-round" onclick="resetRound()">ğŸ”„ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø© (ØªØµÙÙŠØ± Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©)</button>
    </div>

    <div class="panel">
        <h3 style="margin-top:0">ğŸ† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h3>
        <div id="leaderboard">
            <p style="color:#666">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†...</p>
        </div>
    </div>

    <script>
        const config = { 
            apiKey: "AIzaSyBxqfLt3o3JWy_vwnpwSQPIVdtEDGoYB6k",
            authDomain: "fawazir-jaco.firebaseapp.com",
            databaseURL: "https://fawazir-jaco-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "fawazir-jaco",
            storageBucket: "fawazir-jaco.firebasestorage.app",
            messagingSenderId: "862747657100",
            appId: "1:862747657100:web:d52ecee9373a5e33fd8ca9"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        // ØªÙˆÙ„ÙŠØ¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        const container = document.getElementById("btn-container");
        for(let i=0; i<15; i++) {
            let b = document.createElement("button");
            b.className = "q-btn"; b.innerText = "Ø³ " + (i+1);
            b.id = "q" + i;
            b.onclick = () => sendQ(i);
            container.appendChild(b);
        }

        function sendQ(idx) {
            db.ref('currentQuestion').set(idx);
            document.getElementById("winner-name").innerText = "---";
        }

        function resetRound() {
            if(confirm("Ø³ÙŠØªÙ… ØªØµÙÙŠØ± Ø°Ø§ÙƒØ±Ø© Ø¬Ù…ÙŠØ¹ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† Ù„ÙŠØªÙ…ÙƒÙ†ÙˆØ§ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
                db.ref('roundVersion').transaction(v => (v || 0) + 1);
                db.ref('winners').remove();
                alert("ØªÙ… Ø§Ù„ØªØµÙÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            }
        }

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„ÙØ§Ø¦Ø²
        db.ref('currentQuestion').on('value', snap => {
            const idx = snap.val();
            document.querySelectorAll(".q-btn").forEach(b => b.classList.remove("active"));
            
            if(idx !== -1 && idx !== null) {
                if(document.getElementById("q"+idx)) document.getElementById("q"+idx).classList.add("active");
                document.getElementById("active-q").innerText = "Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø§Ù„Ø¢Ù†: Ø±Ù‚Ù… " + (idx+1);
                
                // Ù…Ø±Ø§Ù‚Ø¨Ø© ÙØ§Ø¦Ø² Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
                db.ref('winners/'+idx).on('value', s => {
                    if(s.exists()) {
                        document.getElementById("winner-name").innerText = s.val().name;
                    } else {
                        document.getElementById("winner-name").innerText = "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø£ÙˆÙ„ Ø¥Ø¬Ø§Ø¨Ø©...";
                    }
                });
            } else {
                document.getElementById("active-q").innerText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¤Ø§Ù„ Ù…Ø¨Ø§Ø´Ø± Ø­Ø§Ù„ÙŠØ§Ù‹";
                document.getElementById("winner-name").innerText = "---";
            }
        });

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† (Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù€ ID Ø§Ù„ÙØ±ÙŠØ¯)
        db.ref('users').on('value', snap => {
            const data = snap.val() || {};
            const playersArray = Object.values(data);
            
            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
            const sorted = playersArray.sort((a,b) => (b.points || 0) - (a.points || 0)).slice(0, 10);
            
            const list = document.getElementById("leaderboard");
            list.innerHTML = "";
            
            if(sorted.length === 0) {
                list.innerHTML = "<p style='color:#666'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø· Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</p>";
                return;
            }

            sorted.forEach((p, i) => {
                list.innerHTML += `
                    <div class="leader-item">
                        <span>${i+1}. <b>${p.name}</b></span>
                        <span style="color:var(--blue)">${p.points || 0} Ù†Ù‚Ø·Ø©</span>
                    </div>`;
            });
        });
    </script>
</body>
</html>
