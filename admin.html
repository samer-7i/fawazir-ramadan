<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Remy ğŸ®</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #0a1120; --card: #162136; --blue: #38bdf8; --text: #ffffff; --red: #e94560; --gold: #f59e0b; --accent: #10b981; }
        body { margin: 0; padding: 20px; background: var(--bg); color: var(--text); font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
        .user-logo { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--blue); margin-bottom: 20px; object-fit: cover; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .setup-card { background: var(--card); padding: 30px; border-radius: 25px; border: 2px solid var(--blue); max-width: 400px; width: 85%; text-align: center; }
        input { width: 90%; padding: 15px; border-radius: 12px; border: 1px solid var(--blue); background: #0a1120; color: white; text-align: center; font-size: 1.1em; margin: 15px 0; outline: none; }
        .btn-action { background: var(--blue); color: var(--bg); border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; }
        .main-card { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid rgba(56, 189, 248, 0.2); max-width: 500px; width: 100%; display: none; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
        .user-info { display: flex; justify-content: space-between; background: rgba(255,255,255,0.05); padding: 10px 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(56,189,248,0.2); font-size: 0.9em; }
        .timer-bar { width: 100%; height: 6px; background: rgba(255,255,255,0.1); margin-bottom: 20px; border-radius: 3px; overflow: hidden; }
        #timer-progress { width: 100%; height: 100%; background: var(--blue); transition: width 0.1s linear; }
        #delay-timer { color: var(--gold); font-weight: bold; font-size: 1.2em; margin: 10px 0; }
        .opt-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; border: 1px solid var(--blue); background: rgba(56, 189, 248, 0.05); color: white; border-radius: 12px; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: 0.2s; }
        .opt-btn:hover { background: rgba(56, 189, 248, 0.15); }
        .opt-btn:active:not(:disabled) { transform: scale(0.98); background: var(--blue); color: #000; }
        .opt-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        #status-msg { margin-top: 15px; font-weight: bold; font-size: 1.1em; }
        .footer { margin-top: 30px; padding: 15px; font-size: 0.85em; color: rgba(255, 255, 255, 0.5); text-align: center; }
        .footer a { color: var(--blue); text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

    <img src="logo.png" class="user-logo" onerror="this.style.display='none'">

    <div id="setup-overlay" class="overlay">
        <div class="setup-card" id="rules-step">
            <h2 style="color: var(--blue);">ğŸ“œ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h2>
            <div style="text-align: right; font-size: 0.9em; line-height: 1.6; list-style: none;">
                <li>âœ… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø³ØªØ±ÙŠÙ…Ø± Ø¶Ø±ÙˆØ±ÙŠØ©.</li>
                <li>âœ… ØªØ¸Ù‡Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†Ù Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø³Ø¤Ø§Ù„.</li>
                <li>âœ… Ø£Ø³Ø±Ø¹ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·.</li>
                <li>âœ… ØªØ±ØªÙŠØ¨ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù…Ù†Ø¹ Ø§Ù„ØºØ´.</li>
            </div><br>
            <button class="btn-action" onclick="showNameInput()">Ù…ÙˆØ§ÙÙ‚ âœ…</button>
        </div>
        <div class="setup-card" id="name-step" style="display: none;">
            <h2>Ø³Ø¬Ù„ Ø§Ø³Ù…Ùƒ ğŸ®</h2>
            <input type="text" id="username-input" placeholder="Ø§Ø³Ù…Ùƒ ÙÙŠ Ø¬Ø§ÙƒÙˆ...">
            <button class="btn-action" onclick="saveAndStart()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸš€</button>
        </div>
    </div>

    <div id="waiting-msg" style="display:none; text-align:center; width: 100%; max-width: 500px;">
        <h3 style="color: var(--blue);">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø£Ù† ÙŠØ¨Ø¯Ø£ Remy Ø§Ù„Ø³Ø¤Ø§Ù„... âŒ›</h3>
        <p>Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span id="wait-points" style="font-weight: bold; color: var(--gold);">0</span></p>
    </div>

    <div id="quiz-container" class="main-card">
        <div class="timer-bar"><div id="timer-progress"></div></div>
        <div class="user-info">
            <span id="display-name" style="color: var(--blue); font-weight: bold;">---</span>
            <span>Ù†Ù‚Ø§Ø·ÙŠ: <span id="my-points" style="color: var(--blue); font-weight: bold;">0</span> Ù†</span>
        </div>
        <div id="question-text" style="font-size: 1.4em; margin-bottom: 10px; font-weight: bold;"></div>
        <div id="delay-timer"></div>
        <div id="options-container"></div>
        <div id="status-msg"></div>
    </div>

    <script>
        const config = { 
            apiKey: "AIzaSyBxqfLt3o3JWy_vwnpwSQPIVdtEDGoYB6k",
            authDomain: "fawazir-jaco.firebaseapp.com",
            databaseURL: "https://fawazir-jaco-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "fawazir-jaco",
            storageBucket: "fawazir-jaco.firebasestorage.app",
            messagingSenderId: "862747657100",
            appId: "1:862747657100:web:d52ecee9373a5e33fd8ca9"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        let userName = localStorage.getItem("remy_name_v4");
        let userID = localStorage.getItem("remy_id_v4");
        let timerInterval, delayInterval;
        let isSubmitting = false;

        const myQuestions = [
            { q: "ØºØ§Ø²ÙŠ Ø¹Ø§Ù„Ù…ÙŠØŒ Ù„ÙˆÙ†Ù‡ Ø£Ø­Ù…Ø±ØŒ ÙˆØ§Ø³Ù…Ù‡ ÙŠØªÙƒÙˆÙ† Ù…Ù† ÙƒÙ„Ù…ØªÙŠÙ†ØŸ", options: ["Ø¨Ø¨Ø³ÙŠ", "ÙƒÙˆÙƒØ§ÙƒÙˆÙ„Ø§", "ÙØ§Ù†ØªØ§"], correct: 1 },
            { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠ Ø§Ù„Ø°ÙŠ ÙŠÙƒØ³Ø± Ø¨Ù…Ø¬Ø±Ø¯ Ù†Ø·Ù‚Ù‡ØŸ", options: ["Ø§Ù„ØµÙ…Øª", "Ø§Ù„Ø£ÙƒÙ„", "Ø§Ù„Ù†ÙˆÙ…"], correct: 0 },
            { q: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ØŸ", options: ["Ø§Ù„ÙŠØ§Ø¨Ø§Ù†", "Ø·ÙˆÙƒÙŠÙˆ", "Ø³ÙŠÙˆÙ„"], correct: 1 },
            { q: "Ø´ÙŠØ¡ Ø·ÙˆÙŠÙ„ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø¬Ø¯ÙŠØ¯Ù‹Ø§ØŒ ÙˆÙŠÙ‚ØµØ± ÙƒÙ„Ù…Ø§ Ø§Ø³ØªØ®Ø¯Ù…ØªÙ‡ØŸ", options: ["Ø§Ù„Ø´Ù…Ø¹Ø©", "Ø§Ù„Ù…Ø³ÙˆØ§Ùƒ", "Ø§Ù„Ø«Ù„Ø¬"], correct: 0 },
            { q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø­Ø¬Ø±Ø§Øª Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„ØªÙŠ ÙŠÙ…ØªÙ„ÙƒÙ‡Ø§ Ø§Ù„ØµØ±ØµÙˆØ±ØŸ", options: ["13 Ø­Ø¬Ø±Ø©", "Ø­Ø¬Ø±ØªÙŠÙ†", "Ù„Ø§ ÙŠÙ…Ù„Ùƒ"], correct: 0 },
            { q: "Ø£Ø·ÙˆÙ„ Ø³ÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù†ØŸ", options: ["Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†", "Ø§Ù„Ù†Ø³Ø§Ø¡", "Ø§Ù„Ø¨Ù‚Ø±Ø©"], correct: 2 },
            { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØªÙƒÙ„Ù… Ø¨Ø¯ÙˆÙ† Ù„Ø³Ø§Ù†ØŸ", options: ["Ø§Ù„Ø¬Ø±Ø³", "Ø§Ù„Ù‚Ù„Ù…", "Ø§Ù„Ø¨Ø§Ø¨"], correct: 1 },
            { q: "Ø¹Ø¯Ø¯ Ø¥Ø°Ø§ ØªÙ… Ø¶Ø±Ø¨Ù‡ ÙÙŠ Ù†ÙØ³Ù‡ ÙˆØ¬ÙÙ…Ø¹ Ù…Ø¹Ù‡ ÙŠØ³Ø§ÙˆÙŠ 30ØŸ", options: ["5", "6", "4"], correct: 0 },
            { q: "Ø´ÙŠØ¡ Ø­Ø§Ø± Ø­ØªÙ‰ Ù„Ùˆ ÙˆØ¶Ø¹ØªÙ‡ ÙÙŠ Ø§Ù„Ø«Ù„Ø§Ø¬Ø© Ù„Ø§ ÙŠØ¨Ø±Ø¯ØŸ", options: ["Ø§Ù„Ø®ÙŠØ§Ø±", "Ø§Ù„Ø¨ØµÙ„", "Ø§Ù„ÙÙ„ÙÙ„"], correct: 2 },
            { q: "Ù…Ù…Ø§ ÙŠØªÙƒÙˆÙ† Ø§Ù„Ù†Ø¨Ø§Øª Ø¨Ø´ÙƒÙ„ Ø£Ø³Ø§Ø³ÙŠØŸ", options: ["Ø§Ù„Ø¬Ø°ÙˆØ± ÙˆØ§Ù„Ø³Ø§Ù‚ ÙˆØ§Ù„Ø£ÙˆØ±Ø§Ù‚", "Ø§Ù„Ø¬Ø°ÙˆØ± ÙˆØ§Ù„Ø³Ø§Ù‚ ÙˆØ§Ù„Ø£Ø²Ù‡Ø§Ø±", "Ø§Ù„Ø³Ø§Ù‚ ÙˆØ§Ù„Ø£ÙˆØ±Ø§Ù‚"], correct: 0 },
            { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠÙ†Ø§Ù…ØŸ", options: ["Ø§Ù„Ø®ÙØ§Ø´", "Ø§Ù„Ø³Ù„Ø­ÙØ§Ø©", "Ø§Ù„Ø¶ÙØ¯Ø¹"], correct: 2 },
            { q: "Ù…Ø§ Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠØŸ", options: ["Ø§Ù„Ù†Ø³Ø§Ø¡", "Ø§Ù„Ø¨Ù‚Ø±Ø©", "Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†"], correct: 1 },
            { q: "Ù…Ù† Ù‡Ùˆ Ø§Ù„Ù†Ø¨ÙŠ Ø§Ù„Ø°ÙŠ Ø£Ù„Ù‚Ø§Ù‡ Ù‚ÙˆÙ…Ù‡ ÙÙŠ Ø§Ù„Ù†Ø§Ø± ÙˆÙ„Ù… ØªØ­Ø±Ù‚Ù‡ØŸ", options: ["Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ù…ÙˆØ³Ù‰", "Ø¹ÙŠØ³Ù‰"], correct: 0 },
            { q: "Ù…Ø§ Ù‡Ùˆ Ø£Ø¹Ù„Ù‰ Ø¬Ø¨Ù„ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", options: ["Ø¬Ø¨Ù„ ØªÙ‡Ø§Ù…Ø©", "Ø¬Ø¨Ù„ Ø¥ÙŠÙØ±Ø³Øª", "Ø¬Ø¨Ù„ Ø·ÙˆÙŠÙ‚"], correct: 1 },
            { q: "Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠØªØ¨Ø¹Ùƒ ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù† ÙˆÙŠÙ‚Ù„Ø¯ Ø­Ø±ÙƒØ§ØªÙƒØŸ", options: ["Ø§Ù„Ø¬Ù†ÙŠ", "Ø¸Ù„Ùƒ", "Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª"], correct: 1 },
            { q: "Ù…Ø§ Ù‡ÙŠ Ø£ÙƒØ¨Ø± Ù‚Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ù…Ù† Ø­ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø­Ø© ÙˆØ§Ù„Ø³ÙƒØ§Ù†ØŸ", options: ["Ø¢Ø³ÙŠØ§", "Ø£ÙØ±ÙŠÙ‚ÙŠØ§", "Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§"], correct: 0 },
            { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø³ØªØ­Ø¶Ø± Ø§Ù„Ø°ÙŠ ÙŠØ¬Ø¨ ØªØ·Ø¨ÙŠÙ‚Ù‡ Ù‚Ø¨Ù„ Ø§Ù„Ø¢ÙŠØ´Ø§Ø¯Ùˆ Ù„Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø£Ù„ÙˆØ§Ù†ØŸ", options: ["Ø§Ù„Ø¢ÙŠÙ„Ø§ÙŠÙ†Ø±", "Ø¨Ø±Ø§ÙŠÙ…Ø± Ø§Ù„ÙˆØ¬Ù‡", "Ø¨Ø±Ø§ÙŠÙ…Ø± Ù„Ù„Ø¹ÙŠÙ†"], correct: 2 },
            { q: "ÙƒÙ… ØªØ¨Ù„Øº Ù…Ø³Ø§ÙØ© Ù†Ø¸Ø± Ø²Ø±Ù‚Ø§Ø¡ Ø§Ù„ÙŠÙ…Ø§Ù…Ø©ØŸ", options: ["1000 ÙƒÙŠÙ„Ùˆ", "3000 ÙƒÙŠÙ„Ùˆ", "3 Ø£ÙŠØ§Ù…"], correct: 2 },
            { q: "Ø§ØªØ¨Ø¹ Ø§Ù„Ù†Ù…Ø·: Ø§Ù„Ø£Ø­Ø¯ØŒ Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†ØŒ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ØŒ Ø§Ù„Ø³Ø¨Øª.. Ù…Ø§ Ù‡Ùˆ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠØŸ", options: ["Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³"], correct: 0 },
            { q: "Ù…Ø§ Ù‡ÙŠ Ø£ÙˆÙ„ Ø¹Ù…Ù„Ø© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©ØŸ", options: ["Ù‚Ø±ÙˆØ´ Ø°Ù‡Ø¨ÙŠØ©", "Ø¯ÙŠÙ†Ø§Ø± Ø°Ù‡Ø¨ÙŠ", "Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ"], correct: 1 },
            { q: "Ø£ÙƒØ¨Ø± Ø³Ù„Ø³Ù„Ø© Ù…Ù‚Ø§Ù‡ÙŠ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ø´Ø¹Ø§Ø±Ù‡Ø§ Ø­ÙˆØ±ÙŠØ© Ø®Ø¶Ø±Ø§Ø¡ØŸ", options: ["Ø¯Ø§Ù†ÙƒÙ†", "Ø³ØªØ§Ø±Ø¨ÙƒØ³", "Ø¨Ø§Ø±Ù†ÙŠØ²"], correct: 1 },
            { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠØªØ¬Ù…Ø¯ Ø¨Ø§Ù„Ø­Ø±Ø§Ø±Ø©ØŸ", options: ["Ø§Ù„Ø«Ù„Ø¬", "Ø§Ù„Ø¨ÙŠØ¶", "Ø§Ù„Ø®Ø¨Ø²"], correct: 1 },
            { q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø¢ÙŠØ§Øª Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©ØŸ", options: ["7 Ø¢ÙŠØ§Øª", "8 Ø¢ÙŠØ§Øª", "6 Ø¢ÙŠØ§Øª"], correct: 0 },
            { q: "Ø£ÙŠÙ† ÙŠÙ‚Ø¹ Ù‚Ù„Ø¨ Ø§Ù„Ø¬Ù…Ø¨Ø±ÙŠØŸ", options: ["ÙÙŠ Ø¸Ù‡Ø±Ù‡", "ÙÙŠ Ø¨Ø·Ù†Ù‡", "ÙÙŠ Ø±Ø£Ø³Ù‡"], correct: 2 },
            { q: "Ø£ÙŠ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù†Ø¨Ø§Øª Ù†Ø£ÙƒÙ„Ù‡ ÙÙŠ Ø§Ù„Ø¬Ø²Ø±ØŸ", options: ["Ø¬Ø°ÙˆØ±Ù‡Ø§", "Ø«Ù…Ø§Ø±Ù‡Ø§", "Ø£ÙˆØ±Ø§Ù‚Ù‡Ø§"], correct: 0 },
            { q: "Ø³Ù„Ø³Ù„Ø© Ù…Ø·Ø§Ø¹Ù… Ø¹Ø§Ù„Ù…ÙŠØ© Ø´Ø¹Ø§Ø±Ù‡Ø§ Ø­Ø±Ù M ÙƒØ¨ÙŠØ±ØŸ", options: ["Ù…Ø§ÙƒØ¯ÙˆÙ†Ø§Ù„Ø¯Ø²", "Ù‡Ø±ÙÙŠ", "Ø¨Ø±ØºØ± ÙƒÙ†Ø¬"], correct: 0 },
            { q: "Ø¹Ù†Ø¯Ù…Ø§ Ø³Ø¨Ù‚ Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù†ÙŠØŒ ÙÙ…Ø§ Ù‡Ùˆ Ù…Ø±ÙƒØ²Ù‡ØŸ", options: ["Ø§Ù„Ø£ÙˆÙ„", "Ø§Ù„Ø«Ø§Ù†ÙŠ", "Ø§Ù„Ø«Ø§Ù„Ø«"], correct: 1 },
            { q: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ ÙŠØ­ØªØ§Ø¬Ù‡Ø§ Ø§Ù„Ù†Ø¨Ø§Øª Ù„Ù„Ù†Ù…ÙˆØŸ", options: ["Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³ ÙˆØ§Ù„Ù…Ø§Ø¡ ÙˆØ§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ†", "Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³ ÙˆØ§Ù„Ù…Ø§Ø¡ ÙˆØ«Ø§Ù†ÙŠ Ø£ÙƒØ³ÙŠØ¯ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ†", "Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³ ÙˆØ§Ù„Ù…Ø§Ø¡"], correct: 1 },
            { q: "Ø³Ø¬ÙŠÙ† Ø£Ø±Ø§Ø¯ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù† Ø¬Ø²ÙŠØ±Ø© ÙˆÙ„Ø§ ÙŠØ¬ÙŠØ¯ Ø§Ù„Ø³Ø¨Ø§Ø­Ø©.. ÙƒÙŠÙ Ù‡Ø±Ø¨ØŸ", options: ["Ø³Ø¨Ø­ Ø­ØªÙ‰ Ù‡Ø±Ø¨", "Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ØªØ¬Ù…Ø¯ Ø§Ù„Ù…Ø§Ø¡ ÙˆÙ‡Ø±Ø¨", "ØµÙ†Ø¹ Ù‚Ø§Ø±Ø¨Ù‹Ø§ Ù„Ù„Ù‡Ø±ÙˆØ¨"], correct: 1 },
            { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠØªØ¬Ù…Ø¯ Ø¨Ø§Ù„Ø­Ø±Ø§Ø±Ø©ØŸ", options: ["Ø§Ù„Ø«Ù„Ø¬", "Ø§Ù„Ø¨ÙŠØ¶", "Ø§Ù„Ø®Ø¨Ø²"], correct: 1 }
        ];

        window.onload = () => {
            if (userName && userID) startApp();
            else document.getElementById("setup-overlay").style.display = "flex";
        };

        function showNameInput() {
            document.getElementById("rules-step").style.display = "none";
            document.getElementById("name-step").style.display = "block";
        }

        function saveAndStart() {
            const val = document.getElementById("username-input").value.trim();
            if (!val) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹!");
            const newID = "u_" + Math.random().toString(36).substr(2, 9);
            localStorage.setItem("remy_name_v4", val);
            localStorage.setItem("remy_id_v4", newID);
            userName = val; userID = newID;
            startApp();
        }

        function startApp() {
            document.getElementById("setup-overlay").style.display = "none";
            document.getElementById("display-name").innerText = userName;

            db.ref('roundVersion').on('value', snap => {
                const sVer = snap.val() || 0;
                if (localStorage.getItem("remy_v") != sVer) {
                    for(let key in localStorage) { if(key.startsWith("ans_")) localStorage.removeItem(key); }
                    localStorage.setItem("remy_v", sVer);
                }
            });

            db.ref('users/' + userID + '/points').on('value', snap => {
                const p = snap.val() || 0;
                document.getElementById("my-points").innerText = p;
                document.getElementById("wait-points").innerText = p;
            });
            db.ref('users/' + userID + '/name').set(userName);

            db.ref('celebration').on('value', snap => { if (snap.exists()) launchConfetti(); });

            db.ref('currentQuestion').on('value', snap => {
                const idx = snap.val();
                if (idx === -1 || idx === null) {
                    document.getElementById("quiz-container").style.display = "none";
                    document.getElementById("waiting-msg").style.display = "block";
                    clearInterval(timerInterval);
                    clearInterval(delayInterval);
                } else {
                    document.getElementById("waiting-msg").style.display = "none";
                    document.getElementById("quiz-container").style.display = "block";
                    isSubmitting = false; 
                    prepareQuestion(idx);
                }
            });
        }

        function prepareQuestion(idx) {
            const data = myQuestions[idx];
            if (!data) return;
            clearInterval(timerInterval);
            clearInterval(delayInterval);
            clearInterval(timerInterval); clearInterval(delayInterval);

            document.getElementById("question-text").innerText = data.q;
            const delayArea = document.getElementById("delay-timer");
            const statusMsg = document.getElementById("status-msg");
            document.getElementById("options-container").innerHTML = ""; 
            statusMsg.innerText = "";
            document.getElementById("status-msg").innerText = "";
            document.getElementById("timer-progress").style.width = "100%";

            const answered = localStorage.getItem("ans_" + idx);
            if (answered) {
                delayArea.innerText = "";
                statusMsg.innerText = "ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ âœ‹";
                showFinalOptions(data, idx, true);
                return;
            }

            let timeLeft = 10; 
            delayArea.innerText = `ØªØ¬Ù‡Ø².. ØªØ¸Ù‡Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø®Ù„Ø§Ù„ ${timeLeft}`;
            document.getElementById("delay-timer").innerText = `ØªØ¸Ù‡Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø®Ù„Ø§Ù„ ${timeLeft}`;
            delayInterval = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    clearInterval(delayInterval);
                    delayArea.innerText = "Ø£Ø¬Ø¨ Ø§Ù„Ø¢Ù†! ğŸ”¥";
                    showFinalOptions(data, idx, false);
                    document.getElementById("delay-timer").innerText = "Ø£Ø¬Ø¨ Ø§Ù„Ø¢Ù†! ğŸ”¥";
                    showOptions(data, idx);
                    startTimer();
                } else {
                    delayArea.innerText = `ØªØ¬Ù‡Ø².. ØªØ¸Ù‡Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø®Ù„Ø§Ù„ ${timeLeft}`;
                    document.getElementById("delay-timer").innerText = `ØªØ¸Ù‡Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø®Ù„Ø§Ù„ ${timeLeft}`;
                }
            }, 1000);
        }

        function showFinalOptions(data, idx, isDisabled) {
        function showOptions(data, idx) {
            const container = document.getElementById("options-container");
            container.innerHTML = "";
            
            // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù…Ø¹ Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù…Ø¹Ø§Ù…Ù„ ØµØ­/Ø®Ø·Ø£ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù€ correct index
            let options = data.options.map((text, i) => ({ text: text, isCorrect: i === data.correct }));

            // ØªØ±ØªÙŠØ¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© ÙÙŠØ´Ø±-ÙŠÙŠØªØ³) Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØºØ´
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            // ØªØ±ØªÙŠØ¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª
            options.sort(() => Math.random() - 0.5);

            options.forEach((item) => {
                const b = document.createElement("button");
                b.className = "opt-btn";
                b.innerText = item.text;
                if (isDisabled) b.disabled = true;
                b.onclick = () => submitAnswer(item.isCorrect, idx);
                container.appendChild(b);
            });
        }

        function startTimer() {
            let time = 15;
            timerInterval = setInterval(() => {
                time -= 0.1;
                document.getElementById("timer-progress").style.width = (time / 15) * 100 + "%";
                if (time <= 0) { clearInterval(timerInterval); disableAll("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! â±ï¸"); }
            }, 100);
        }

        function submitAnswer(isCorrect, qIdx) {
            if (isSubmitting) return;
            isSubmitting = true;

            clearInterval(timerInterval);
            clearInterval(delayInterval);
            localStorage.setItem("ans_" + qIdx, "true");
            disableAll("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...");
            document.getElementById("delay-timer").innerText = "";

            // --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ Ù‡Ù†Ø§ ---
            const statusStr = isCorrect ? "correct" : "wrong";

            db.ref('answers_logs/' + qIdx).push({ 
                name: userName, 
                status: statusStr, 
                timestamp: firebase.database.ServerValue.TIMESTAMP 
            });

            if (!isCorrect) {
                document.getElementById("status-msg").innerText = "Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© âŒ";
                document.getElementById("status-msg").style.color = "var(--red)";
                return;
            }

            db.ref('winners/' + qIdx).transaction(curr => {
                if (curr === null) return { name: userName, id: userID };
                return;
            }, (err, comm) => {
                if (comm) {
                    document.getElementById("status-msg").innerText = "ÙƒÙÙˆ! Ø£Ù†Øª Ø§Ù„Ø£ÙˆÙ„ ğŸ‰";
                    document.getElementById("status-msg").style.color = "var(--accent)";
                    db.ref('users/' + userID + '/points').transaction(p => (p || 0) + 1);
                } else {
                    document.getElementById("status-msg").innerText = "ØµØ­ØŒ Ù„ÙƒÙ† ØºÙŠØ±Ùƒ Ø£Ø³Ø±Ø¹ ğŸ’¨";
                    document.getElementById("status-msg").style.color = "var(--gold)";
                }
            });
        }

        function disableAll(msg) {
            document.querySelectorAll(".opt-btn").forEach(b => b.disabled = true);
            if(msg) document.getElementById("status-msg").innerText = msg;
        }

        function launchConfetti() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, zIndex: 3000 });
        }
    </script>

    <footer class="footer">
        ØªÙ… Ø§Ù„ØªØµÙ…ÙŠÙ… Ø¨ÙˆØ§Ø³Ø·Ø© <a href="https://www.instagram.com/taz7i_/" target="_blank">Ø³Ø§Ù…Ø±</a> ğŸ› ï¸
    </footer>
</body>
</html>
