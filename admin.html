<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Remy Ø§Ù„Ù…Ø­Ø¯Ø«Ø© ğŸ‘‘</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #0a1120; --card: #162136; --blue: #38bdf8; --red: #e94560; --text: #ffffff; --accent: #10b981; --gold: #f59e0b; }
        body { margin: 0; padding: 20px; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; }
        
        .main-layout { display: grid; grid-template-columns: 1fr 380px; gap: 20px; width: 100%; max-width: 1200px; }
        .panel { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid rgba(56, 189, 248, 0.2); margin-bottom: 20px; }
        
        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© */
        .q-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin: 15px 0; }
        .q-btn { background: rgba(255, 255, 255, 0.05); color: var(--blue); border: 1px solid rgba(56, 189, 248, 0.3); padding: 10px 2px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .q-btn.active { background: var(--blue); color: #000; box-shadow: 0 0 15px var(--blue); }
        
        .section-title { border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 15px; color: var(--blue); font-weight: bold; }
        
        /* Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„ÙˆØ­Ø© */
        .live-status-container { display: flex; flex-direction: column; gap: 15px; }
        .mini-live-box { background: rgba(0,0,0,0.2); border-radius: 12px; padding: 10px; border-top: 3px solid #ccc; }
        .box-correct { border-color: var(--accent); }
        .box-wrong { border-color: var(--red); }
        .box-title { font-size: 0.8em; margin-bottom: 8px; display: flex; justify-content: space-between; }

        .name-list { max-height: 150px; overflow-y: auto; font-size: 0.9em; }
        .name-tag { display: inline-block; background: rgba(255,255,255,0.05); padding: 3px 10px; border-radius: 5px; margin: 2px; border: 1px solid rgba(255,255,255,0.1); }
        .correct-tag { color: var(--accent); border-color: var(--accent); }
        .wrong-tag { color: var(--red); border-color: var(--red); }

        .btn { padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-stop { background: var(--red); color: white; }
        .btn-reset { background: var(--gold); color: white; }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªÙˆØ¨ */
        .leader-item { display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255,255,255,0.03); margin-bottom: 5px; border-radius: 8px; border-right: 3px solid var(--gold); }
    </style>
</head>
<body>

    <div class="main-layout">
        <div class="control-col">
            <div class="panel" style="text-align: center;">
                <h2 style="margin:0">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø±ÙŠÙ…ÙŠ ğŸ‘‘</h2>
                <div id="q-display" style="margin: 15px 0; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                    <div id="q-text" style="font-weight:bold; color: var(--blue);">Ø§Ø®ØªØ± Ø³Ø¤Ø§Ù„Ø§Ù‹...</div>
                </div>
                <div style="color: var(--accent);">Ø£ÙˆÙ„ Ù…Ù† Ø¬Ø§ÙˆØ¨ ØµØ­: <span id="fastest-name" style="font-weight:bold;">---</span></div>
            </div>

            <div class="panel">
                <div class="section-title">ğŸ® Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„ØªØ­ÙƒÙ…</div>
                <div class="q-grid" id="q-btns"></div>
                <button class="btn btn-stop" onclick="updateQ(-1)">ğŸ›‘ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø¤Ø§Ù„</button>
                <button class="btn btn-reset" onclick="resetRound()">ğŸ”„ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ù…Ø³Ø­ Ø§Ù„Ø³Ø±Ø¹Ø© ÙÙ‚Ø·)</button>
            </div>
        </div>

        <div class="status-col">
            <div class="panel">
                <div class="section-title">ğŸ“Š Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</div>
                <div class="live-status-container">
                    
                    <div class="mini-live-box box-correct">
                        <div class="box-title" style="color: var(--accent);"><span>âœ… Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©</span> <span id="count-correct">0</span></div>
                        <div id="list-correct" class="name-list"></div>
                    </div>

                    <div class="mini-live-box box-wrong">
                        <div class="box-title" style="color: var(--red);"><span>âŒ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø®Ø§Ø·Ø¦Ø©</span> <span id="count-wrong">0</span></div>
                        <div id="list-wrong" class="name-list"></div>
                    </div>

                </div>
            </div>

            <div class="panel">
                <div class="section-title">ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† (Ø§Ù„ØªÙˆØ¨)</div>
                <div id="top-list" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
        const config = { 
            apiKey: "AIzaSyBxqfLt3o3JWy_vwnpwSQPIVdtEDGoYB6k",
            authDomain: "fawazir-jaco.firebaseapp.com",
            databaseURL: "https://fawazir-jaco-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "fawazir-jaco",
            storageBucket: "fawazir-jaco.firebasestorage.app",
            messagingSenderId: "862747657100",
            appId: "1:862747657100:web:d52ecee9373a5e33fd8ca9"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        const btnsArea = document.getElementById("q-btns");
        for(let i=0; i<30; i++) {
            let b = document.createElement("button");
            b.className = "q-btn"; b.innerText = (i+1);
            b.id = "btn-"+i;
            b.onclick = () => updateQ(i);
            btnsArea.appendChild(b);
        }

        function updateQ(idx) {
            db.ref('currentQuestion').set(idx);
            // ØªØµÙÙŠØ± Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø¤Ø§Ù„
            document.getElementById("list-correct").innerHTML = "";
            document.getElementById("list-wrong").innerHTML = "";
        }

        function resetRound() {
            if(confirm("ØªØµÙÙŠØ± Ø§Ù„Ø³Ø±Ø¹Ø©ØŸ (Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù† ØªÙØ­Ø°Ù)")) {
                db.ref('winners').remove();
                db.ref('answers_logs').remove();
            }
        }

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
        db.ref('currentQuestion').on('value', snap => {
            const idx = snap.val();
            document.querySelectorAll(".q-btn").forEach(b => b.classList.remove("active"));
            if(idx !== -1 && idx !== null) {
                document.getElementById("btn-"+idx).classList.add("active");
                document.getElementById("q-text").innerText = "Ø§Ù„Ø³Ø¤Ø§Ù„ " + (idx+1) + " Ù†Ø´Ø· Ø§Ù„Ø¢Ù†";
                
                // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ù†ÙØµÙ„Ø©
                db.ref('answers_logs/' + idx).on('value', s => {
                    const lCorrect = document.getElementById("list-correct");
                    const lWrong = document.getElementById("list-wrong");
                    let cCount = 0, wCount = 0;
                    lCorrect.innerHTML = ""; lWrong.innerHTML = "";

                    s.forEach(child => {
                        const data = child.val();
                        const tag = `<span class="name-tag ${data.status === 'correct' ? 'correct-tag' : 'wrong-tag'}">${data.name}</span>`;
                        if(data.status === 'correct') { lCorrect.innerHTML += tag; cCount++; }
                        else { lWrong.innerHTML += tag; wCount++; }
                    });
                    document.getElementById("count-correct").innerText = cCount;
                    document.getElementById("count-wrong").innerText = wCount;
                });

                db.ref('winners/'+idx).on('value', s => {
                    document.getElementById("fastest-name").innerText = s.exists() ? s.val().name : "---";
                });
            }
        });

        // Ù„ÙˆØ­Ø© Ø§Ù„ØªÙˆØ¨ (ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ø¦Ù…)
        db.ref('users').on('value', snap => {
            const users = [];
            snap.forEach(c => users.push(c.val()));
            users.sort((a,b) => (b.points || 0) - (a.points || 0));
            
            const area = document.getElementById("top-list");
            area.innerHTML = "";
            users.slice(0, 10).forEach((u, i) => {
                area.innerHTML += `<div class="leader-item">
                    <span>${i+1}. ${u.name}</span>
                    <span style="color:var(--gold)">${u.points || 0} Ù†</span>
                </div>`;
            });
        });
    </script>
</body>
</html>
